---
title: ガイドラインとベストプラクティス
description: Things to keep in mind when implementing a Mastodon app.
menu:
  docs:
    weight: 50
    parent: client
---

## ログイン {#login}

**ユーザーは、アプリからどのMastodonサーバーに対してもログインできなければなりません**。これは、サーバーのドメインを尋ね、アプリ登録APIを動的に使ってOAuth2資格情報を取得しなければならないことを意味します。

## ユーザー名 {#username}

**分散化はユーザーに対して透過的でなければなりません**。 たとえば、特定のユーザーが別のサーバーに属していることを確認できなければなりません。たとえば、どこかに`acct`を表示するなどの対応が必要です。`acct`はローカルユーザーに対してはユーザー名と同一で、リモートユーザーに対してはusername@domainのような形式です。

## IDの取扱いと並び替え {#id}

ヴァニラの（素の）MastodonのエンティティIDは整数型で、文字列型にキャストされています。ただし、これはIDが整数であることを意味するものではなく、整数にキャストする必要もありません！ それを行うと、整数オーバーフローによりクライアントアプリがクラッシュする可能性があります。そのため**IDは常に文字列として扱ってください。**

とは言うものの、IDは数値の文字列表現であるため、次のようにすることで時系列に簡単に並び替えることができます：

1. 長さで並び替え。新しい投稿は長いIDを持ちます。
2. 単語的に並び替え。新しい投稿には、位置的に比較して少なくとも1桁高い数字が含まれます。

## フォーマット {#formatting}

プレーンテキストはリモートサーバーからのコンテンツには使用できません。プレーンテキストの構文ルールは、Mastodonと他の実装との間で大幅に異なる可能性があります。投稿など特定の属性については、**MastodonはサニタイズされたHTML形式**で提供します。`<p>`, `<br>`, `<span>`, `<a>`といったタグが含まれます。詳しくは[HTMLサニタイズ](../spec/activitypub.md#html-sanitization)を参照してください。

### メンション、ハッシュタグ、カスタム絵文字 {#tags}

メンションとハッシュタグは`<a>`タグです。カスタム絵文字はショートコードの平文で残されます。それらのエンティティに意味を与え、ウェブページとしてでなく、アプリ内でプロフィールを開くなどの特別な処理を追加するためのメタデータが[Status]({{< relref "../entities/status.md" >}})に含まれ、特定のタグに一致させることができます。詳しくは[Status &gt; Rendering attributes](../entities/status.md#rendering-attributes) を参照してください。

### リンクの短縮化 {#links}

MastodonにおけるリンクはURL短縮機能を使って短縮されないため、URL短縮機能の使用は極力避けてください。テキスト内のURLは常に23文字として数えられ、見た目上は短縮されます。そのために、リンクは下記のようにマークアップされます：

```markup
<a href="https://example.com/page/that/is/very/long">
  <span class="invisible">https://</span>
  <span class="ellipsis">example.com/page</span>
  <span class="invisible">/that/is/very/long</span>
</a>
```

`invisible`クラスのspanは隠されます。中間のspanは見えるようするためのものです。URLがさほど長くない場合はclassがないことがあります。そうでなければ `ellipsis`  クラスを持ちます。省略記号\(`…`\)はマークアップに含まれませんので、必要な場合はアプリ側で挿入する必要があります。

## フィルター {#filters}

クライアントは、APIから返されたフィルター情報に基づいて独自のテキストフィルタリングを行う必要があります。サーバーはホームと通知のコンテキストに `irreversible` フィルターを適用しますが、それ以外はクライアント側でフィルタリングを行う必要があります！

期限切れのフィルターはサーバーによって削除されません。フィルターは適用されないはずですが、サーバーには保存されています。ユーザーがフィルターを再度有効にするために有効期限を更新することがあります。最終的なフィルターの削除はユーザーの責任において行われます。


